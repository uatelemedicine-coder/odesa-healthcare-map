<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–û–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞ –∫–∞—Ä—Ç–∞ –ó–û–ó –û–¥–µ—Å—å–∫–æ—ó –æ–±–ª–∞—Å—Ç—ñ | 13.12.2025</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0f172a;
      --bg-secondary: rgba(15, 23, 42, 0.97);
      --bg-card: rgba(30, 41, 59, 0.5);
      --bg-card-hover: #1e293b;
      --border-color: #1e293b;
      --text-primary: #ffffff;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --accent-blue: #3b82f6;
      --accent-green: #22c55e;
      --accent-green-light: #4ade80;
      --accent-red: #ef4444;
      --accent-red-light: #f87171;
      --accent-amber: #fbbf24;
      --accent-orange: #f97316;
      --input-bg: #1e293b;
      --input-border: #334155;
      --shadow-color: rgba(0,0,0,0.4);
    }
    [data-theme="light"] {
      --bg-primary: #f1f5f9;
      --bg-secondary: rgba(255, 255, 255, 0.97);
      --bg-card: rgba(241, 245, 249, 0.8);
      --bg-card-hover: #e2e8f0;
      --border-color: #cbd5e1;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-muted: #64748b;
      --input-bg: #ffffff;
      --input-border: #cbd5e1;
      --shadow-color: rgba(0,0,0,0.1);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg-primary); color: var(--text-primary); overflow: hidden; transition: background 0.3s, color 0.3s; }
    #map { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
    .header { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: linear-gradient(to bottom, var(--bg-primary), var(--bg-primary), transparent); padding: 12px 16px 40px; pointer-events: none; }
    .header-content { display: flex; align-items: center; gap: 12px; pointer-events: auto; }
    .logo { width: 44px; height: 44px; background: linear-gradient(135deg, #fbbf24, #f97316); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 20px rgba(251, 191, 36, 0.3); }
    .logo svg { width: 26px; height: 26px; color: white; }
    .header-text h1 { font-size: 18px; font-weight: 700; letter-spacing: -0.5px; }
    .header-text p { font-size: 12px; color: var(--text-secondary); margin-top: 2px; }
    
    .controls-panel { position: fixed; top: 16px; right: 400px; z-index: 1002; display: flex; gap: 8px; }
    .control-group { background: var(--bg-card); backdrop-filter: blur(10px); border: 1px solid var(--border-color); border-radius: 12px; padding: 8px; display: flex; gap: 4px; }
    .control-group button { width: 36px; height: 36px; border: none; border-radius: 8px; background: transparent; color: var(--text-muted); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
    .control-group button:hover { background: var(--bg-card-hover); color: var(--text-primary); }
    .control-group button.active { background: var(--accent-blue); color: white; }
    .control-group button.active-orange { background: var(--accent-orange); color: white; }
    
    .sidebar { position: fixed; top: 0; right: 0; width: 380px; height: 100%; background: var(--bg-secondary); backdrop-filter: blur(20px); border-left: 1px solid var(--border-color); z-index: 1001; display: flex; flex-direction: column; transform: translateX(0); transition: transform 0.3s, background 0.3s; }
    .sidebar.hidden { transform: translateX(100%); }
    .sidebar-header { padding-top: 70px; }
    .tabs { display: flex; border-bottom: 1px solid var(--border-color); }
    .tab { flex: 1; padding: 12px; text-align: center; font-size: 13px; font-weight: 500; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s; }
    .tab:hover { color: var(--text-primary); background: var(--bg-card); }
    .tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); }
    .tab-content { display: none; flex: 1; flex-direction: column; overflow: hidden; }
    .tab-content.active { display: flex; }
    .district-overview { padding: 16px; overflow-y: auto; flex: 1; }
    .district-card { padding: 14px; border-radius: 12px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s; border: 1px solid var(--border-color); background: var(--bg-card); }
    .district-card:hover { transform: translateX(4px); border-color: var(--accent-blue); }
    .district-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .district-card-name { font-size: 15px; font-weight: 600; }
    .district-card-status { display: flex; align-items: center; gap: 6px; font-size: 12px; font-weight: 500; padding: 4px 10px; border-radius: 20px; }
    .district-card-status.power-yes { background: rgba(250, 204, 21, 0.15); color: #facc15; }
    .district-card-status.power-partial { background: rgba(249, 115, 22, 0.15); color: #f97316; }
    .district-card-status.power-no { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
    .district-card-status .dot { width: 8px; height: 8px; border-radius: 50%; }
    .district-card-status.power-yes .dot { background: #facc15; }
    .district-card-status.power-partial .dot { background: #f97316; }
    .district-card-status.power-no .dot { background: #3b82f6; }
    .district-card-stats { display: flex; gap: 16px; font-size: 12px; color: var(--text-secondary); }
    .district-card-stats span { display: flex; align-items: center; gap: 4px; }
    .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 16px; border-bottom: 1px solid var(--border-color); }
    .stat-card { padding: 12px; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.2s; border: 1px solid transparent; background: var(--bg-card); }
    .stat-card:hover { background: var(--bg-card-hover); }
    .stat-card.active { border-color: rgba(59, 130, 246, 0.5); background: rgba(59, 130, 246, 0.1); }
    .stat-card.active-green { border-color: rgba(34, 197, 94, 0.5); background: rgba(34, 197, 94, 0.1); }
    .stat-card.active-red { border-color: rgba(239, 68, 68, 0.5); background: rgba(239, 68, 68, 0.1); }
    .stat-number { font-size: 28px; font-weight: 700; }
    .stat-number.green { color: var(--accent-green-light); }
    .stat-number.red { color: var(--accent-red-light); }
    .stat-label { font-size: 11px; color: var(--text-secondary); margin-top: 4px; }
    .filters { padding: 12px 16px; border-bottom: 1px solid var(--border-color); display: flex; flex-direction: column; gap: 10px; }
    .search-box { position: relative; }
    .search-box svg { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); width: 16px; height: 16px; color: var(--text-muted); }
    .search-box input { width: 100%; padding: 10px 12px 10px 40px; background: var(--input-bg); border: 1px solid var(--input-border); border-radius: 10px; color: var(--text-primary); font-size: 14px; outline: none; transition: border-color 0.2s, background 0.3s; }
    .search-box input:focus { border-color: var(--accent-blue); }
    .search-box input::placeholder { color: var(--text-muted); }
    select { width: 100%; padding: 10px 12px; background: var(--input-bg); border: 1px solid var(--input-border); border-radius: 10px; color: var(--text-primary); font-size: 14px; outline: none; cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; background-size: 16px; transition: background 0.3s; }
    select:focus { border-color: var(--accent-blue); }
    .facility-list { flex: 1; overflow-y: auto; }
    .facility-item { padding: 12px 16px; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: background 0.2s; display: flex; gap: 12px; align-items: flex-start; }
    .facility-item:hover { background: var(--bg-card); }
    .facility-status { width: 10px; height: 10px; border-radius: 50%; margin-top: 4px; flex-shrink: 0; }
    .facility-status.on { background: var(--accent-green); }
    .facility-status.off { background: var(--accent-red); }
    .facility-info { flex: 1; min-width: 0; }
    .facility-name { font-size: 14px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .facility-meta { font-size: 12px; color: var(--text-muted); margin-top: 3px; }
    .facility-tags { display: flex; gap: 8px; margin-top: 6px; font-size: 11px; color: var(--text-secondary); }
    .facility-tags span.heat { color: var(--accent-amber); }
    .facility-arrow { color: var(--text-muted); flex-shrink: 0; margin-top: 4px; }
    .detail-view { padding: 16px; display: none; flex-direction: column; gap: 16px; overflow-y: auto; flex: 1; }
    .detail-view.active { display: flex; }
    .back-btn { display: flex; align-items: center; gap: 8px; color: var(--text-secondary); font-size: 13px; cursor: pointer; transition: color 0.2s; background: none; border: none; }
    .back-btn:hover { color: var(--text-primary); }
    .detail-header h2 { font-size: 18px; font-weight: 600; margin-bottom: 4px; }
    .detail-header p { font-size: 13px; color: var(--text-muted); }
    .status-badge { display: inline-flex; align-items: center; gap: 8px; padding: 10px 14px; border-radius: 12px; font-size: 13px; font-weight: 500; }
    .status-badge.on { background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: var(--accent-green-light); }
    .status-badge.off { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); color: var(--accent-red-light); }
    .status-dot { width: 10px; height: 10px; border-radius: 50%; animation: pulse 2s infinite; }
    .status-badge.on .status-dot { background: var(--accent-green); }
    .status-badge.off .status-dot { background: var(--accent-red); }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .info-grid { display: flex; flex-direction: column; gap: 8px; }
    .info-row { display: flex; gap: 12px; padding: 12px; background: var(--bg-card); border-radius: 10px; }
    .info-icon { font-size: 16px; flex-shrink: 0; }
    .info-content { flex: 1; min-width: 0; }
    .info-label { font-size: 11px; color: var(--text-muted); margin-bottom: 2px; }
    .info-value { font-size: 13px; color: var(--text-secondary); word-break: break-word; }
    .sidebar-footer { padding: 12px 16px; border-top: 1px solid var(--border-color); text-align: center; background: var(--bg-secondary); }
    .sidebar-footer p { font-size: 11px; color: var(--text-muted); }
    .legend { position: fixed; bottom: 16px; left: 16px; background: var(--bg-secondary); backdrop-filter: blur(10px); border-radius: 12px; border: 1px solid var(--border-color); padding: 12px 16px; z-index: 1000; }
    .legend-title { font-size: 11px; font-weight: 600; color: var(--text-secondary); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
    .legend-section { margin-bottom: 10px; }
    .legend-section:last-child { margin-bottom: 0; }
    .legend-section-title { font-size: 10px; color: var(--text-muted); margin-bottom: 6px; }
    .legend-items { display: flex; flex-direction: column; gap: 6px; }
    .legend-item { display: flex; align-items: center; gap: 8px; color: var(--text-secondary); font-size: 12px; }
    .legend-dot { width: 10px; height: 10px; border-radius: 50%; }
    .legend-dot.green { background: var(--accent-green); }
    .legend-dot.red { background: var(--accent-red); }
    .legend-rect { width: 20px; height: 12px; border-radius: 3px; opacity: 0.7; }
    .legend-rect.yellow { background: #facc15; }
    .legend-rect.orange { background: #f97316; }
    .legend-rect.blue { background: #3b82f6; }
    .toggle-btn { display: none; position: fixed; bottom: 16px; right: 16px; width: 56px; height: 56px; background: var(--accent-blue); border-radius: 50%; border: none; color: white; z-index: 1002; box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4); cursor: pointer; }
    .empty-state { padding: 48px 16px; text-align: center; color: var(--text-muted); }
    .empty-state .icon { font-size: 40px; margin-bottom: 8px; }
    .leaflet-popup-content-wrapper { background: var(--bg-card-hover); border-radius: 12px; box-shadow: 0 10px 40px var(--shadow-color); }
    .leaflet-popup-content { margin: 12px; color: var(--text-primary); font-family: 'Inter', sans-serif; }
    .leaflet-popup-tip { background: var(--bg-card-hover); }
    .leaflet-container { background: var(--bg-primary); }
    .popup-title { font-weight: 600; font-size: 14px; margin-bottom: 4px; }
    .popup-district { font-size: 12px; color: var(--text-secondary); margin-bottom: 8px; }
    .popup-status { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 500; }
    .popup-status.on { background: rgba(34, 197, 94, 0.15); color: var(--accent-green-light); }
    .popup-status.off { background: rgba(239, 68, 68, 0.15); color: var(--accent-red-light); }
    .popup-status span { width: 6px; height: 6px; border-radius: 50%; }
    .popup-status.on span { background: var(--accent-green); }
    .popup-status.off span { background: var(--accent-red); }
    .data-source { position: fixed; top: 70px; left: 16px; background: var(--bg-secondary); backdrop-filter: blur(10px); border-radius: 8px; border: 1px solid var(--border-color); padding: 8px 12px; z-index: 1000; font-size: 11px; color: var(--text-muted); display: flex; align-items: center; gap: 8px; }
    .data-source .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--accent-green); animation: pulse 2s infinite; }
    .data-source.loading .dot { background: var(--accent-amber); }
    .data-source.error .dot { background: var(--accent-red); }
    @media (max-width: 768px) { .sidebar { width: 100%; } .toggle-btn { display: flex; align-items: center; justify-content: center; } .controls-panel { right: 16px; top: auto; bottom: 80px; flex-direction: column; } }
  </style>
</head>
<body>
  <div id="map"></div>
  <header class="header">
    <div class="header-content">
      <div class="logo"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg></div>
      <div class="header-text"><h1>–û–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞ –∫–∞—Ä—Ç–∞ –ó–û–ó</h1><p>–û–¥–µ—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å ‚Ä¢ 13.12.2025</p></div>
    </div>
  </header>
  
  <div class="controls-panel">
    <div class="control-group" title="–¢–µ–º–∞">
      <button id="darkBtn" class="active" onclick="setTheme('dark')" title="–¢–µ–º–Ω–∞ —Ç–µ–º–∞">
        <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
      </button>
      <button id="lightBtn" onclick="setTheme('light')" title="–°–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞">
        <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
      </button>
    </div>
    <div class="control-group" title="–ó–∞–ª–∏–≤–∫–∞ —Ä–∞–π–æ–Ω—ñ–≤">
      <button id="colorBtn" class="active-orange" onclick="toggleDistrictColors()" title="–ü–æ–∫–∞–∑–∞—Ç–∏/—Å—Ö–æ–≤–∞—Ç–∏ –∑–∞–ª–∏–≤–∫—É —Ä–∞–π–æ–Ω—ñ–≤">
        <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/></svg>
      </button>
    </div>
  </div>
  
  <div class="data-source loading" id="dataSource"><div class="dot"></div><span>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ—Ñ—ñ—Ü—ñ–π–Ω–∏—Ö –º–µ–∂ —Ä–∞–π–æ–Ω—ñ–≤...</span></div>
  
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="tabs">
        <div class="tab active" onclick="switchTab('districts')">–†–∞–π–æ–Ω–∏</div>
        <div class="tab" onclick="switchTab('facilities')">–ó–∞–∫–ª–∞–¥–∏</div>
      </div>
    </div>
    <div class="tab-content active" id="tabDistricts">
      <div class="district-overview" id="districtOverview"></div>
    </div>
    <div class="tab-content" id="tabFacilities">
      <div class="stats-grid">
        <div class="stat-card active" id="statAll" onclick="setFilter('all')"><div class="stat-number" id="totalCount">0</div><div class="stat-label">–í—Å—å–æ–≥–æ</div></div>
        <div class="stat-card" id="statOn" onclick="setFilter('on')"><div class="stat-number green" id="onCount">0</div><div class="stat-label">–ó—ñ —Å–≤—ñ—Ç–ª–æ–º</div></div>
        <div class="stat-card" id="statOff" onclick="setFilter('off')"><div class="stat-number red" id="offCount">0</div><div class="stat-label">–ë–µ–∑ —Å–≤—ñ—Ç–ª–∞</div></div>
      </div>
      <div class="filters">
        <div class="search-box">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
          <input type="text" id="searchInput" placeholder="–ü–æ—à—É–∫ –∑–∞–∫–ª–∞–¥—É..." oninput="filterFacilities()">
        </div>
        <select id="districtSelect" onchange="filterFacilities()"><option value="">–í—Å—ñ —Ä–∞–π–æ–Ω–∏</option></select>
      </div>
      <div class="facility-list" id="facilityList"></div>
      <div class="detail-view" id="detailView">
        <button class="back-btn" onclick="hideDetail()"><svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>–ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É</button>
        <div class="detail-header"><h2 id="detailName"></h2><p id="detailFullName"></p></div>
        <div id="detailStatus"></div>
        <div class="info-grid" id="detailInfo"></div>
      </div>
    </div>
    <div class="sidebar-footer"><p>–î–∞–Ω—ñ —Å—Ç–∞–Ω–æ–º –Ω–∞ 13.12.2025 ‚Ä¢ –ö–ù–ü "–û–û–ö–õ" –û–î–ê</p></div>
  </aside>
  
  <div class="legend">
    <div class="legend-title">–£–º–æ–≤–Ω—ñ –ø–æ–∑–Ω–∞—á–µ–Ω–Ω—è</div>
    <div class="legend-section">
      <div class="legend-section-title">–†–∞–π–æ–Ω–∏ (–µ–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è)</div>
      <div class="legend-items">
        <div class="legend-item"><div class="legend-rect yellow"></div><span>–Ñ —Å–≤—ñ—Ç–ª–æ</span></div>
        <div class="legend-item"><div class="legend-rect orange"></div><span>–ß–∞—Å—Ç–∫–æ–≤–æ</span></div>
        <div class="legend-item"><div class="legend-rect blue"></div><span>–ù–µ–º–∞—î —Å–≤—ñ—Ç–ª–∞</span></div>
      </div>
    </div>
    <div class="legend-section">
      <div class="legend-section-title">–ó–∞–∫–ª–∞–¥–∏</div>
      <div class="legend-items">
        <div class="legend-item"><div class="legend-dot green"></div><span>–ó—ñ —Å–≤—ñ—Ç–ª–æ–º</span></div>
        <div class="legend-item"><div class="legend-dot red"></div><span>–ë–µ–∑ —Å–≤—ñ—Ç–ª–∞</span></div>
      </div>
    </div>
  </div>
  
  <button class="toggle-btn" id="toggleBtn" onclick="toggleSidebar()">
    <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
  </button>
  
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // –ù–∞–∑–≤–∏ —Ä–∞–π–æ–Ω—ñ–≤ –û–¥–µ—Å—å–∫–æ—ó –æ–±–ª–∞—Å—Ç—ñ –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó
    const ODESA_OBLAST_DISTRICTS = [
      '–û–¥–µ—Å—å–∫–∏–π —Ä–∞–π–æ–Ω',
      '–ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∏–π —Ä–∞–π–æ–Ω', 
      '–Ü–∑–º–∞—ó–ª—å—Å—å–∫–∏–π —Ä–∞–π–æ–Ω',
      '–ë–æ–ª–≥—Ä–∞–¥—Å—å–∫–∏–π —Ä–∞–π–æ–Ω',
      '–†–æ–∑–¥—ñ–ª—å–Ω—è–Ω—Å—å–∫–∏–π —Ä–∞–π–æ–Ω',
      '–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π —Ä–∞–π–æ–Ω',
      '–ë–µ—Ä–µ–∑—ñ–≤—Å—å–∫–∏–π —Ä–∞–π–æ–Ω'
    ];

    const districtPowerStatus = {
      '–û–¥–µ—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': 'partial',
      '–ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': 'yes',
      '–Ü–∑–º–∞—ó–ª—å—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': 'no',
      '–ë–æ–ª–≥—Ä–∞–¥—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': 'yes',
      '–†–æ–∑–¥—ñ–ª—å–Ω—è–Ω—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': 'partial',
      '–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': 'partial',
      '–ë–µ—Ä–µ–∑—ñ–≤—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': 'no'
    };

    const districtColors = { 'yes': '#facc15', 'partial': '#f97316', 'no': '#3b82f6' };
    const districtStatusLabels = { 'yes': '–Ñ —Å–≤—ñ—Ç–ª–æ', 'partial': '–ß–∞—Å—Ç–∫–æ–≤–æ', 'no': '–ù–µ–º–∞—î —Å–≤—ñ—Ç–ª–∞' };

    const districtInfo = {
      '–û–¥–µ—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': { population: '1360.9 —Ç–∏—Å.', shortName: '–û–¥–µ—Å—å–∫–∏–π' },
      '–ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': { population: '201.4 —Ç–∏—Å.', shortName: '–ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∏–π' },
      '–Ü–∑–º–∞—ó–ª—å—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': { population: '206.2 —Ç–∏—Å.', shortName: '–Ü–∑–º–∞—ó–ª—å—Å—å–∫–∏–π' },
      '–ë–æ–ª–≥—Ä–∞–¥—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': { population: '154.5 —Ç–∏—Å.', shortName: '–ë–æ–ª–≥—Ä–∞–¥—Å—å–∫–∏–π' },
      '–†–æ–∑–¥—ñ–ª—å–Ω—è–Ω—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': { population: '104.2 —Ç–∏—Å.', shortName: '–†–æ–∑–¥—ñ–ª—å–Ω—è–Ω—Å—å–∫–∏–π' },
      '–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': { population: '229.9 —Ç–∏—Å.', shortName: '–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π' },
      '–ë–µ—Ä–µ–∑—ñ–≤—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': { population: '123.3 —Ç–∏—Å.', shortName: '–ë–µ—Ä–µ–∑—ñ–≤—Å—å–∫–∏–π' }
    };

    let facilitiesData = [
      { id: 1, name: '–ö–ù–ü "–û–¥–µ—Å—å–∫–∞ –æ–±–ª–∞—Å–Ω–∞ –∫–ª—ñ–Ω—ñ—á–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', shortName: '–û–±–ª–∞—Å–Ω–∞ –∫–ª—ñ–Ω—ñ—á–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è', district: '–û–¥–µ—Å—å–∫–∏–π —Ä–∞–π–æ–Ω', type: '–û–±–ª–∞—Å–Ω–∏–π –∑–∞–∫–ª–∞–¥', hasElectricity: false, alternativePower: '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∏, —Å–æ–Ω—è—á–Ω—ñ –ø–∞–Ω–µ–ª—ñ, –î–ë–ñ', fuelReserve: '7 –¥—ñ–±', heating: '–≤–ª–∞—Å–Ω–∞ –∫–æ—Ç–µ–ª—å–Ω—è', water: '–≤–ª–∞—Å–Ω–∞ —Å–≤–µ—Ä–¥–ª–æ–≤–∏–Ω–∞', waterReserve: '100000 –ª', communication: '–ù–∞—è–≤–Ω–∏–π', damages: '–Ω—ñ', contact: '–õ—è—à–µ–Ω–∫–æ –ê—Ä—Ç–µ–º –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á 0668035861', lat: 46.4775, lng: 30.7326 },
      { id: 2, name: '–ö–ù–ü "–û–¥–µ—Å—å–∫–∞ –æ–±–ª–∞—Å–Ω–∞ –¥–∏—Ç—è—á–∞ –∫–ª—ñ–Ω—ñ—á–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', shortName: '–û–±–ª–∞—Å–Ω–∞ –¥–∏—Ç—è—á–∞ –ª—ñ–∫–∞—Ä–Ω—è', district: '–û–¥–µ—Å—å–∫–∏–π —Ä–∞–π–æ–Ω', type: '–û–±–ª–∞—Å–Ω–∏–π –∑–∞–∫–ª–∞–¥', hasElectricity: false, alternativePower: '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∏, —Å–æ–Ω—è—á–Ω—ñ –ø–∞–Ω–µ–ª—ñ, –î–ë–ñ', fuelReserve: '5 –¥—ñ–±', heating: '–≤–ª–∞—Å–Ω–∞ –∫–æ—Ç–µ–ª—å–Ω—è', water: '—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ', waterReserve: '90000 —Ç–µ—Ö–Ω. / 2700 –ø–∏—Ç–Ω–∞', communication: '–Ñ', damages: '–Ω—ñ', contact: '–ß—ñ—Ö–≤–∞—Ä—ñ—è –•–≤—ñ—á–∞ –û—Ç–∞—Ä–æ–≤–∏—á 0674838818', lat: 46.4695, lng: 30.7456 },
      { id: 3, name: '–ö–ù–ü "–û–¥–µ—Å—å–∫–∏–π –æ–±–ª–∞—Å–Ω–∏–π –∫–ª—ñ–Ω—ñ—á–Ω–∏–π –º–µ–¥–∏—á–Ω–∏–π —Ü–µ–Ω—Ç—Ä"', shortName: '–û–±–ª–∞—Å–Ω–∏–π –º–µ–¥. —Ü–µ–Ω—Ç—Ä', district: '–û–¥–µ—Å—å–∫–∏–π —Ä–∞–π–æ–Ω', type: '–û–±–ª–∞—Å–Ω–∏–π –∑–∞–∫–ª–∞–¥', hasElectricity: false, alternativePower: '–°–æ–Ω—è—á–Ω—ñ –±–∞—Ç–∞—Ä–µ—ó', fuelReserve: '20 –¥—ñ–±', heating: '–≤—ñ–¥—Å—É—Ç–Ω—î', water: '–≤—ñ–¥—Å—É—Ç–Ω—î', waterReserve: '5 –ª', communication: '–Ñ', damages: '–Ω—ñ', contact: '–¢–∫–∞—á –í.–ê. 097 615 4722', lat: 46.4825, lng: 30.7216 },
      { id: 9, name: '–ö–ü "–ë–∞–ª—Ç—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', shortName: '–ë–∞–ª—Ç—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è', district: '–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π —Ä–∞–π–æ–Ω', type: '–ú—ñ—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è', hasElectricity: true, alternativePower: '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∏, —Å–æ–Ω—è—á–Ω–∞ —Å—Ç–∞–Ω—Ü—ñ—è, –î–ë–ñ', fuelReserve: '10 –¥—ñ–±', heating: '–≤–ª–∞—Å–Ω–∞ –∫–æ—Ç–µ–ª—å–Ω—è', water: '—Å–≤–µ—Ä–¥–ª–æ–≤–∏–Ω–∞', waterReserve: '20000 –ª', communication: '–ù–∞—è–≤–Ω–∏–π', damages: '–≤—ñ–¥—Å—É—Ç–Ω—ñ', contact: '–ö–∞—Ü–º–∞–∑–∞ –†–æ–º–∞–Ω 0952284517', lat: 47.9361, lng: 29.6233 },
      { id: 10, name: '–ö–ù–ü "–ë–µ—Ä–µ–∑—ñ–≤—Å—å–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –º—ñ—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è"', shortName: '–ë–µ—Ä–µ–∑—ñ–≤—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è', district: '–ë–µ—Ä–µ–∑—ñ–≤—Å—å–∫–∏–π —Ä–∞–π–æ–Ω', type: '–ú—ñ—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è', hasElectricity: false, alternativePower: '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä, —Å–æ–Ω—è—á–Ω—ñ –±–∞—Ç–∞—Ä–µ—ó', fuelReserve: '10 –¥—ñ–±', heating: '–≤–ª–∞—Å–Ω–∞ –∫–æ—Ç–µ–ª—å–Ω—è', water: '—Å–≤–µ—Ä–¥–ª–æ–≤–∏–Ω–∞', waterReserve: '25000 –ª', communication: '–ù–∞—è–≤–Ω–∏–π', damages: '–≤—ñ–¥—Å—É—Ç–Ω—ñ', contact: '–ê–ª–µ–π–Ω–æ–≤ –û–ª–µ–∫—Å–∞–Ω–¥—Ä 0688730373', lat: 47.1914, lng: 30.9161 },
      { id: 11, name: '–ö–ù–ü "–ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∞ –º—ñ—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', shortName: '–ë-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∞ –º—ñ—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è', district: '–ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∏–π —Ä–∞–π–æ–Ω', type: '–ú—ñ—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è', hasElectricity: true, alternativePower: '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∏, –∞–∫—É–º—É–ª—è—Ç–æ—Ä–∏, –î–ë–ñ', fuelReserve: '7 –¥—ñ–±', heating: '—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –∫–æ—Ç–µ–ª—å–Ω—è', water: '—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ', waterReserve: '18000 –ª', communication: '–ù–∞—è–≤–Ω–∏–π', damages: '–≤—ñ–¥—Å—É—Ç–Ω—ñ', contact: '–ñ–Ω—è–∫—ñ–Ω –í—ñ—Ç–∞–ª—ñ–π 0977226393', lat: 46.1958, lng: 30.3461 },
      { id: 12, name: '–ö–ù–ü "–ö—ñ–ª—ñ–π—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', shortName: '–ö—ñ–ª—ñ–π—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è', district: '–Ü–∑–º–∞—ó–ª—å—Å—å–∫–∏–π —Ä–∞–π–æ–Ω', type: '–ú—ñ—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è', hasElectricity: false, alternativePower: '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä', fuelReserve: '7 –¥—ñ–±', heating: '–∞–≤—Ç–æ–Ω–æ–º–Ω–µ (–≤—É–≥—ñ–ª—å–Ω—ñ –∫–æ—Ç–ª–∏)', water: '—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ + —Ä–µ–∑–µ—Ä–≤', waterReserve: '41000 –ª', communication: '–ú–æ–±—ñ–ª—å–Ω–∏–π', damages: '–≤—ñ–¥—Å—É—Ç–Ω—ñ', contact: "–ñ—É—Ä'—è–Ω –í–∞—Å–∏–ª—ñ–π 0972174231", lat: 45.4422, lng: 29.2672 },
      { id: 13, name: '–ö–ù–ü "–ü–æ–¥—ñ–ª—å—Å—å–∫–∞ –º—ñ—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è"', shortName: '–ü–æ–¥—ñ–ª—å—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è', district: '–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π —Ä–∞–π–æ–Ω', type: '–ú—ñ—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è', hasElectricity: false, alternativePower: '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∏, —Å–æ–Ω—è—á–Ω—ñ –ø–∞–Ω–µ–ª—ñ, –∞–∫—É–º—É–ª—è—Ç–æ—Ä–∏', fuelReserve: '7 –¥—ñ–±', heating: '–≤–ª–∞—Å–Ω–∞ –∫–æ—Ç–µ–ª—å–Ω—è', water: '—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ', waterReserve: '6000 –ª', communication: '–ù–∞—è–≤–Ω–∏–π', damages: '–≤—ñ–¥—Å—É—Ç–Ω—ñ', contact: '–õ—ñ—Ç—è–Ω—Å—å–∫–∏–π –î–º–∏—Ç—Ä–æ 0984842595', lat: 47.7494, lng: 29.5300 },
      { id: 14, name: '–ö–ù–ü "–†–æ–∑–¥—ñ–ª—å–Ω—è–Ω—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', shortName: '–†–æ–∑–¥—ñ–ª—å–Ω—è–Ω—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è', district: '–†–æ–∑–¥—ñ–ª—å–Ω—è–Ω—Å—å–∫–∏–π —Ä–∞–π–æ–Ω', type: '–ú—ñ—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è', hasElectricity: true, alternativePower: '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∏, —Å–æ–Ω—è—á–Ω—ñ –ø–∞–Ω–µ–ª—ñ', fuelReserve: '7 –¥—ñ–±', heating: '—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ, –Ω–∞—è–≤–Ω–µ', water: '—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ + —Å–≤–µ—Ä–¥–ª–æ–≤–∏–Ω–∞', waterReserve: '6000 –ª', communication: '–ù–∞—è–≤–Ω–∏–π', damages: '–≤—ñ–¥—Å—É—Ç–Ω—ñ', contact: '–û—Å–∏–ø–æ–≤ –í.–û. 0669244340', lat: 46.8461, lng: 30.0828 },
      { id: 15, name: '–ö–ù–ü "–ß–æ—Ä–Ω–æ–º–æ—Ä—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è"', shortName: '–ß–æ—Ä–Ω–æ–º–æ—Ä—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è', district: '–û–¥–µ—Å—å–∫–∏–π —Ä–∞–π–æ–Ω', type: '–ú—ñ—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è', hasElectricity: true, alternativePower: '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∏', fuelReserve: '7 –¥—ñ–±', heating: '—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ', water: '—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ', waterReserve: '25000 –ª', communication: '–ù–∞—è–≤–Ω–∏–π', damages: '–≤—ñ–¥—Å—É—Ç–Ω—ñ', contact: '–ê–Ω–¥—Ä—î—î–≤ –Æ—Ä—ñ–π 063 726 2404', lat: 46.3039, lng: 30.6553 },
      { id: 23, name: '–ö–ù–ü "–ë–µ—Å—Å–∞—Ä–∞–±—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', shortName: '–ë–µ—Å—Å–∞—Ä–∞–±—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è', district: '–ë–æ–ª–≥—Ä–∞–¥—Å—å–∫–∏–π —Ä–∞–π–æ–Ω', type: '–°–µ–ª–∏—â–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è', hasElectricity: true, alternativePower: '–î–∏–∑–µ–ª—å-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä', fuelReserve: '7 –¥—ñ–±', heating: '–≤–ª–∞—Å–Ω–∞ –∫–æ—Ç–µ–ª—å–Ω—è', water: '—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ', waterReserve: '3000 –ª', communication: '–ù–µ –ø–æ—Ä—É—à–µ–Ω–∏–π', damages: '–Ω–µ–º–∞—î', contact: '–†–æ—Ç–∞—Ä –°.–Ü. 0982674276', lat: 46.1865, lng: 29.1501 },
      { id: 24, name: '–ö–ù–ü "–Ü–≤–∞–Ω—ñ–≤—Å—å–∫–∏–π –º–µ–¥–∏—á–Ω–∏–π —Ü–µ–Ω—Ç—Ä"', shortName: '–Ü–≤–∞–Ω—ñ–≤—Å—å–∫–∏–π –º–µ–¥. —Ü–µ–Ω—Ç—Ä', district: '–ë–µ—Ä–µ–∑—ñ–≤—Å—å–∫–∏–π —Ä–∞–π–æ–Ω', type: '–°–µ–ª–∏—â–Ω–∏–π —Ü–µ–Ω—Ç—Ä', hasElectricity: true, alternativePower: '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∏, Tesla', fuelReserve: '5 –¥–Ω—ñ–≤', heating: '–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–µ', water: '–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–µ', waterReserve: '8000 –ª', communication: '–Ñ', damages: '–≤—ñ–¥—Å—É—Ç–Ω—ñ', contact: '–ú–∞—Ü–∫—É–ª –ì–∞–ª–∏–Ω–∞ 0505170002', lat: 47.2833, lng: 30.7167 },
    ];
    
    let map, markers = [], districtLayers = [], currentFilter = 'all', selectedFacilityId = null, currentTheme = 'dark', tileLayer = null;
    let showDistrictColors = true;
    let allDistrictsGeojson = null;
    
    const tileLayers = { dark: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', light: 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png' };
    
    // URL –æ—Ñ—ñ—Ü—ñ–π–Ω–∏—Ö –¥–∞–Ω–∏—Ö —Ä–∞–π–æ–Ω—ñ–≤ –£–∫—Ä–∞—ó–Ω–∏ (—Ä–µ—Ñ–æ—Ä–º–∞ 2020)
    const DISTRICTS_GEOJSON_URL = 'https://cdn.jsdelivr.net/gh/slawomirmatuszak/ukrainian_geodata@main/rayony.geojson';
    
    function setTheme(theme) {
      currentTheme = theme;
      document.body.setAttribute('data-theme', theme);
      document.getElementById('darkBtn').classList.toggle('active', theme === 'dark');
      document.getElementById('lightBtn').classList.toggle('active', theme === 'light');
      localStorage.setItem('mapTheme', theme);
      if (tileLayer) map.removeLayer(tileLayer);
      tileLayer = L.tileLayer(tileLayers[theme], { attribution: '&copy; OSM &copy; CARTO' }).addTo(map);
      drawDistrictPolygons();
      updateMarkers();
    }
    
    function toggleDistrictColors() {
      showDistrictColors = !showDistrictColors;
      document.getElementById('colorBtn').classList.toggle('active-orange', showDistrictColors);
      drawDistrictPolygons();
    }
    
    function switchTab(tabName) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      if (tabName === 'districts') {
        document.querySelectorAll('.tab')[0].classList.add('active');
        document.getElementById('tabDistricts').classList.add('active');
      } else {
        document.querySelectorAll('.tab')[1].classList.add('active');
        document.getElementById('tabFacilities').classList.add('active');
      }
    }
    
    async function loadDistrictBoundaries() {
      const ds = document.getElementById('dataSource');
      
      try {
        console.log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ—Ñ—ñ—Ü—ñ–π–Ω–∏—Ö –º–µ–∂ —Ä–∞–π–æ–Ω—ñ–≤...');
        const response = await fetch(DISTRICTS_GEOJSON_URL);
        
        if (!response.ok) {
          throw new Error(`HTTP error: ${response.status}`);
        }
        
        allDistrictsGeojson = await response.json();
        console.log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ —Ä–∞–π–æ–Ω—ñ–≤:', allDistrictsGeojson.features.length);
        
        ds.classList.remove('loading');
        ds.querySelector('span').textContent = '–û—Ñ—ñ—Ü—ñ–π–Ω—ñ –º–µ–∂—ñ —Ä–∞–π–æ–Ω—ñ–≤ (2020)';
        
        drawDistrictPolygons();
        
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–∂:', error);
        ds.classList.remove('loading');
        ds.classList.add('error');
        ds.querySelector('span').textContent = '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–∂';
      }
    }
    
    function initMap() {
      const savedTheme = localStorage.getItem('mapTheme') || 'dark';
      document.body.setAttribute('data-theme', savedTheme);
      currentTheme = savedTheme;
      document.getElementById('darkBtn').classList.toggle('active', savedTheme === 'dark');
      document.getElementById('lightBtn').classList.toggle('active', savedTheme === 'light');
      map = L.map('map', { center: [46.5, 29.8], zoom: 7, zoomControl: false });
      tileLayer = L.tileLayer(tileLayers[savedTheme], { attribution: '&copy; OSM &copy; CARTO' }).addTo(map);
      L.control.zoom({ position: 'bottomright' }).addTo(map);
      
      loadDistrictBoundaries();
      updateMarkers();
      populateDistricts();
      updateStats();
      renderFacilityList();
      renderDistrictOverview();
    }
    
    function drawDistrictPolygons() {
      districtLayers.forEach(l => map.removeLayer(l));
      districtLayers = [];
      
      if (!allDistrictsGeojson) return;
      
      // –§—ñ–ª—å—Ç—Ä—É—î–º–æ —Ç—ñ–ª—å–∫–∏ —Ä–∞–π–æ–Ω–∏ –û–¥–µ—Å—å–∫–æ—ó –æ–±–ª–∞—Å—Ç—ñ
      const odesaDistricts = allDistrictsGeojson.features.filter(feature => {
        const name = feature.properties.name || feature.properties.NAME || '';
        return ODESA_OBLAST_DISTRICTS.some(d => name.includes(d) || d.includes(name));
      });
      
      console.log('–ó–Ω–∞–π–¥–µ–Ω–æ —Ä–∞–π–æ–Ω—ñ–≤ –û–¥–µ—Å—å–∫–æ—ó –æ–±–ª–∞—Å—Ç—ñ:', odesaDistricts.length);
      
      odesaDistricts.forEach(feature => {
        const name = feature.properties.name || feature.properties.NAME || '';
        const districtName = ODESA_OBLAST_DISTRICTS.find(d => name.includes(d) || d.includes(name)) || name;
        const status = districtPowerStatus[districtName] || 'partial';
        const color = districtColors[status];
        
        const layer = L.geoJSON(feature, {
          style: {
            fillColor: showDistrictColors ? color : 'transparent',
            fillOpacity: showDistrictColors ? 0.35 : 0,
            color: color,
            weight: 3,
            opacity: 0.9
          }
        });
        
        layer.on('click', () => {
          document.getElementById('districtSelect').value = districtName;
          filterFacilities();
          switchTab('facilities');
          const bounds = layer.getBounds();
          map.fitBounds(bounds, { padding: [50, 50], duration: 0.8 });
        });
        
        layer.on('mouseover', (e) => { e.target.setStyle({ fillOpacity: showDistrictColors ? 0.5 : 0.2, weight: 4 }); });
        layer.on('mouseout', (e) => { e.target.setStyle({ fillOpacity: showDistrictColors ? 0.35 : 0, weight: 3 }); });
        
        const info = districtInfo[districtName];
        layer.bindTooltip(`<strong>${info?.shortName || districtName}</strong><br>${districtStatusLabels[status]}<br>${info?.population || ''}`, {
          permanent: false, direction: 'center'
        });
        
        layer.addTo(map);
        districtLayers.push({ layer, name: districtName });
      });
    }
    
    function renderDistrictOverview() {
      const container = document.getElementById('districtOverview');
      const districts = ODESA_OBLAST_DISTRICTS.sort((a, b) => {
        const order = { 'yes': 0, 'partial': 1, 'no': 2 };
        return order[districtPowerStatus[a]] - order[districtPowerStatus[b]];
      });
      container.innerHTML = districts.map(d => {
        const info = districtInfo[d];
        const status = districtPowerStatus[d];
        const facilities = facilitiesData.filter(f => f.district === d);
        const withPower = facilities.filter(f => f.hasElectricity).length;
        const statusClass = status === 'yes' ? 'power-yes' : status === 'partial' ? 'power-partial' : 'power-no';
        return `<div class="district-card" onclick="zoomToDistrict('${d}')">
          <div class="district-card-header">
            <div class="district-card-name">${info?.shortName || d}</div>
            <div class="district-card-status ${statusClass}"><div class="dot"></div>${districtStatusLabels[status]}</div>
          </div>
          <div class="district-card-stats">
            <span>üë• ${info?.population || ''}</span>
            <span>üè• ${facilities.length}</span>
            <span>‚ö° ${withPower}/${facilities.length}</span>
          </div>
        </div>`;
      }).join('');
    }
    
    function zoomToDistrict(districtName) {
      const districtLayer = districtLayers.find(d => d.name === districtName);
      if (districtLayer) {
        const bounds = districtLayer.layer.getBounds();
        map.fitBounds(bounds, { padding: [50, 50], duration: 0.8 });
      }
      document.getElementById('districtSelect').value = districtName;
      filterFacilities();
      switchTab('facilities');
    }
    
    function createMarkerIcon(hasElectricity, isSelected = false) {
      const color = hasElectricity ? '#22c55e' : '#ef4444';
      const borderColor = isSelected ? '#fbbf24' : (currentTheme === 'dark' ? '#1e293b' : '#ffffff');
      const size = isSelected ? 28 : 22;
      return L.divIcon({
        className: 'custom-marker',
        html: `<div style="width:${size}px;height:${size}px;background:${color};border:3px solid ${borderColor};border-radius:50%;box-shadow:0 3px 12px rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center"><svg width="${size*0.5}px" height="${size*0.5}px" viewBox="0 0 24 24" fill="white">${hasElectricity?'<path d="M13 3L4 14h7l-2 7 9-11h-7l2-7z"/>':'<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z" fill-opacity="0.3"/><line x1="4" y1="4" x2="20" y2="20" stroke="white" stroke-width="2"/>'}</svg></div>`,
        iconSize: [size, size], iconAnchor: [size/2, size/2], popupAnchor: [0, -size/2]
      });
    }
    
    function updateMarkers() {
      markers.forEach(m => map.removeLayer(m));
      markers = [];
      getFilteredFacilities().forEach(f => {
        const marker = L.marker([f.lat, f.lng], { icon: createMarkerIcon(f.hasElectricity, selectedFacilityId === f.id) });
        const shortDistrict = districtInfo[f.district]?.shortName || f.district;
        marker.bindPopup(`<div class="popup-title">${f.shortName}</div><div class="popup-district">${shortDistrict}</div><div class="popup-status ${f.hasElectricity?'on':'off'}"><span></span>${f.hasElectricity?'–Ñ –µ–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è':'–ë–µ–∑ –µ–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è'}</div>`);
        marker.on('click', () => showDetail(f.id));
        marker.addTo(map);
        markers.push(marker);
      });
    }
    
    function getFilteredFacilities() {
      let result = [...facilitiesData];
      if (currentFilter === 'on') result = result.filter(f => f.hasElectricity);
      else if (currentFilter === 'off') result = result.filter(f => !f.hasElectricity);
      const district = document.getElementById('districtSelect').value;
      if (district) result = result.filter(f => f.district === district);
      const search = document.getElementById('searchInput').value.toLowerCase();
      if (search) result = result.filter(f => f.name.toLowerCase().includes(search) || f.shortName.toLowerCase().includes(search) || f.district.toLowerCase().includes(search));
      return result;
    }
    
    function populateDistricts() {
      const select = document.getElementById('districtSelect');
      ODESA_OBLAST_DISTRICTS.sort().forEach(d => {
        const info = districtInfo[d];
        const opt = document.createElement('option');
        opt.value = d;
        opt.textContent = `${info?.shortName || d} (${info?.population || ''})`;
        select.appendChild(opt);
      });
    }
    
    function updateStats() {
      const filtered = getFilteredFacilities();
      document.getElementById('totalCount').textContent = filtered.length;
      document.getElementById('onCount').textContent = filtered.filter(f => f.hasElectricity).length;
      document.getElementById('offCount').textContent = filtered.filter(f => !f.hasElectricity).length;
    }
    
    function setFilter(type) {
      currentFilter = type;
      document.querySelectorAll('.stat-card').forEach(c => c.classList.remove('active','active-green','active-red'));
      if (type === 'all') document.getElementById('statAll').classList.add('active');
      else if (type === 'on') document.getElementById('statOn').classList.add('active-green');
      else document.getElementById('statOff').classList.add('active-red');
      filterFacilities();
    }
    
    function filterFacilities() { updateStats(); updateMarkers(); renderFacilityList(); }
    
    function renderFacilityList() {
      const list = document.getElementById('facilityList');
      const filtered = getFilteredFacilities();
      if (!filtered.length) { list.innerHTML = '<div class="empty-state"><div class="icon">üîç</div><div>–ó–∞–∫–ª–∞–¥—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</div></div>'; return; }
      list.innerHTML = filtered.map(f => {
        const shortDistrict = districtInfo[f.district]?.shortName || f.district;
        return `<div class="facility-item" onclick="showDetail(${f.id})">
        <div class="facility-status ${f.hasElectricity?'on':'off'}"></div>
        <div class="facility-info">
          <div class="facility-name">${f.shortName}</div>
          <div class="facility-meta">${shortDistrict} ‚Ä¢ ${f.type}</div>
          <div class="facility-tags"><span>‚õΩ ${f.fuelReserve}</span>${f.heating.includes('–∫–æ—Ç–µ–ª—å–Ω—è')?'<span class="heat">üî• –∫–æ—Ç–µ–ª—å–Ω—è</span>':''}</div>
        </div>
        <svg class="facility-arrow" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
      </div>`}).join('');
    }
    
    function showDetail(id) {
      const f = facilitiesData.find(x => x.id === id);
      if (!f) return;
      selectedFacilityId = id;
      document.getElementById('facilityList').style.display = 'none';
      document.getElementById('detailView').classList.add('active');
      document.getElementById('detailName').textContent = f.shortName;
      document.getElementById('detailFullName').textContent = f.name;
      document.getElementById('detailStatus').innerHTML = `<div class="status-badge ${f.hasElectricity?'on':'off'}"><div class="status-dot"></div>${f.hasElectricity?'–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è –Ω–∞—è–≤–Ω–µ':'–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—î'}</div>`;
      const shortDistrict = districtInfo[f.district]?.shortName || f.district;
      const rows = [['‚ö°','–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–µ –∂–∏–≤–ª–µ–Ω–Ω—è',f.alternativePower],['‚õΩ','–ó–∞–ø–∞—Å –ø–∞–ª–∏–≤–∞',f.fuelReserve],['üî•','–¢–µ–ø–ª–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è',f.heating],['üíß','–í–æ–¥–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è',f.water],['üö∞','–ó–∞–ø–∞—Å –≤–æ–¥–∏',f.waterReserve],['üì°','–ó–≤\'—è–∑–æ–∫',f.communication],['üí•','–ü–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è',f.damages],['üìç','–†–∞–π–æ–Ω',shortDistrict],['üè•','–¢–∏–ø',f.type]];
      if (f.contact) rows.push(['üìû','–ö–æ–Ω—Ç–∞–∫—Ç',f.contact]);
      document.getElementById('detailInfo').innerHTML = rows.map(r => `<div class="info-row"><div class="info-icon">${r[0]}</div><div class="info-content"><div class="info-label">${r[1]}</div><div class="info-value">${r[2]}</div></div></div>`).join('');
      map.flyTo([f.lat, f.lng], 14, { duration: 0.8 });
      updateMarkers();
    }
    
    function hideDetail() { selectedFacilityId = null; document.getElementById('facilityList').style.display = 'block'; document.getElementById('detailView').classList.remove('active'); updateMarkers(); }
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('hidden'); }
    
    document.addEventListener('DOMContentLoaded', initMap);
  </script>
</body>
</html>
